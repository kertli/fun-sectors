<?php

namespace App\DataFixtures;

use App\Dto\SectorDto;
use App\Entity\Sector;
use Doctrine\Bundle\FixturesBundle\Fixture;
use Doctrine\Persistence\ObjectManager;
use Symfony\Component\Serializer\SerializerInterface;

class SectorFixtures extends Fixture
{
    private const DATA = '[{"id":1,"name":"Manufacturing","parent":null},{"id":19,"name":"Construction materials","parent":{"id":1,"name":"Manufacturing","parent":null}},{"id":18,"name":"Electronics and Optics","parent":{"id":1,"name":"Manufacturing","parent":null}},{"id":6,"name":"Food and Beverage","parent":{"id":1,"name":"Manufacturing","parent":null}},{"id":342,"name":"Bakery &amp; confectionery products","parent":{"id":6,"name":"Food and Beverage","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":43,"name":"Beverages","parent":{"id":6,"name":"Food and Beverage","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":42,"name":"Fish &amp; fish products ","parent":{"id":6,"name":"Food and Beverage","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":40,"name":"Meat &amp; meat products","parent":{"id":6,"name":"Food and Beverage","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":39,"name":"Milk &amp; dairy products ","parent":{"id":6,"name":"Food and Beverage","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":437,"name":"Other","parent":{"id":6,"name":"Food and Beverage","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":378,"name":"Sweets &amp; snack food","parent":{"id":6,"name":"Food and Beverage","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":13,"name":"Furniture","parent":{"id":1,"name":"Manufacturing","parent":null}},{"id":389,"name":"Bathroom/sauna ","parent":{"id":13,"name":"Furniture","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":385,"name":"Bedroom","parent":{"id":13,"name":"Furniture","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":390,"name":"Children’s room ","parent":{"id":13,"name":"Furniture","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":98,"name":"Kitchen ","parent":{"id":13,"name":"Furniture","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":101,"name":"Living room ","parent":{"id":13,"name":"Furniture","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":392,"name":"Office","parent":{"id":13,"name":"Furniture","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":394,"name":"Other (Furniture)","parent":{"id":13,"name":"Furniture","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":341,"name":"Outdoor ","parent":{"id":13,"name":"Furniture","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":99,"name":"Project furniture","parent":{"id":13,"name":"Furniture","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}},{"id":94,"name":"Machinery components","parent":{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":91,"name":"Machinery equipment/tools","parent":{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":224,"name":"Manufacture of machinery ","parent":{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":97,"name":"Maritime","parent":{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":271,"name":"Aluminium and steel workboats ","parent":{"id":97,"name":"Maritime","parent":{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}}}},{"id":269,"name":"Boat/Yacht building","parent":{"id":97,"name":"Maritime","parent":{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}}}},{"id":230,"name":"Ship repair and conversion","parent":{"id":97,"name":"Maritime","parent":{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}}}},{"id":93,"name":"Metal structures","parent":{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":508,"name":"Other","parent":{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":227,"name":"Repair and maintenance service","parent":{"id":12,"name":"Machinery","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":11,"name":"Metalworking","parent":{"id":1,"name":"Manufacturing","parent":null}},{"id":67,"name":"Construction of metal structures","parent":{"id":11,"name":"Metalworking","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":263,"name":"Houses and buildings","parent":{"id":11,"name":"Metalworking","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":267,"name":"Metal products","parent":{"id":11,"name":"Metalworking","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":542,"name":"Metal works","parent":{"id":11,"name":"Metalworking","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":75,"name":"CNC-machining","parent":{"id":542,"name":"Metal works","parent":{"id":11,"name":"Metalworking","parent":{"id":1,"name":"Manufacturing","parent":null}}}},{"id":62,"name":"Forgings, Fasteners ","parent":{"id":542,"name":"Metal works","parent":{"id":11,"name":"Metalworking","parent":{"id":1,"name":"Manufacturing","parent":null}}}},{"id":69,"name":"Gas, Plasma, Laser cutting","parent":{"id":542,"name":"Metal works","parent":{"id":11,"name":"Metalworking","parent":{"id":1,"name":"Manufacturing","parent":null}}}},{"id":66,"name":"MIG, TIG, Aluminum welding","parent":{"id":542,"name":"Metal works","parent":{"id":11,"name":"Metalworking","parent":{"id":1,"name":"Manufacturing","parent":null}}}},{"id":9,"name":"Plastic and Rubber","parent":{"id":1,"name":"Manufacturing","parent":null}},{"id":54,"name":"Packaging","parent":{"id":9,"name":"Plastic and Rubber","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":556,"name":"Plastic goods","parent":{"id":9,"name":"Plastic and Rubber","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":559,"name":"Plastic processing technology","parent":{"id":9,"name":"Plastic and Rubber","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":55,"name":"Blowing","parent":{"id":559,"name":"Plastic processing technology","parent":{"id":9,"name":"Plastic and Rubber","parent":{"id":1,"name":"Manufacturing","parent":null}}}},{"id":57,"name":"Moulding","parent":{"id":559,"name":"Plastic processing technology","parent":{"id":9,"name":"Plastic and Rubber","parent":{"id":1,"name":"Manufacturing","parent":null}}}},{"id":53,"name":"Plastics welding and processing","parent":{"id":559,"name":"Plastic processing technology","parent":{"id":9,"name":"Plastic and Rubber","parent":{"id":1,"name":"Manufacturing","parent":null}}}},{"id":560,"name":"Plastic profiles","parent":{"id":9,"name":"Plastic and Rubber","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":5,"name":"Printing ","parent":{"id":1,"name":"Manufacturing","parent":null}},{"id":148,"name":"Advertising","parent":{"id":5,"name":"Printing ","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":150,"name":"Book/Periodicals printing","parent":{"id":5,"name":"Printing ","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":145,"name":"Labelling and packaging printing","parent":{"id":5,"name":"Printing ","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":7,"name":"Textile and Clothing","parent":{"id":1,"name":"Manufacturing","parent":null}},{"id":44,"name":"Clothing","parent":{"id":7,"name":"Textile and Clothing","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":45,"name":"Textile","parent":{"id":7,"name":"Textile and Clothing","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":8,"name":"Wood","parent":{"id":1,"name":"Manufacturing","parent":null}},{"id":337,"name":"Other (Wood)","parent":{"id":8,"name":"Wood","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":51,"name":"Wooden building materials","parent":{"id":8,"name":"Wood","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":47,"name":"Wooden houses","parent":{"id":8,"name":"Wood","parent":{"id":1,"name":"Manufacturing","parent":null}}},{"id":3,"name":"Other","parent":null},{"id":37,"name":"Creative industries","parent":{"id":3,"name":"Other","parent":null}},{"id":29,"name":"Energy technology","parent":{"id":3,"name":"Other","parent":null}},{"id":33,"name":"Environment","parent":{"id":3,"name":"Other","parent":null}},{"id":2,"name":"Service","parent":null},{"id":25,"name":"Business services","parent":{"id":2,"name":"Service","parent":null}},{"id":35,"name":"Engineering","parent":{"id":2,"name":"Service","parent":null}},{"id":28,"name":"Information Technology and Telecommunications","parent":{"id":2,"name":"Service","parent":null}},{"id":581,"name":"Data processing, Web portals, E-marketing","parent":{"id":28,"name":"Information Technology and Telecommunications","parent":{"id":2,"name":"Service","parent":null}}},{"id":576,"name":"Programming, Consultancy","parent":{"id":28,"name":"Information Technology and Telecommunications","parent":{"id":2,"name":"Service","parent":null}}},{"id":121,"name":"Software, Hardware","parent":{"id":28,"name":"Information Technology and Telecommunications","parent":{"id":2,"name":"Service","parent":null}}},{"id":122,"name":"Telecommunications","parent":{"id":28,"name":"Information Technology and Telecommunications","parent":{"id":2,"name":"Service","parent":null}}},{"id":22,"name":"Tourism","parent":{"id":2,"name":"Service","parent":null}},{"id":141,"name":"Translation services","parent":{"id":2,"name":"Service","parent":null}},{"id":21,"name":"Transport and Logistics","parent":{"id":2,"name":"Service","parent":null}},{"id":111,"name":"Air","parent":{"id":21,"name":"Transport and Logistics","parent":{"id":2,"name":"Service","parent":null}}},{"id":114,"name":"Rail","parent":{"id":21,"name":"Transport and Logistics","parent":{"id":2,"name":"Service","parent":null}}},{"id":112,"name":"Road","parent":{"id":21,"name":"Transport and Logistics","parent":{"id":2,"name":"Service","parent":null}}},{"id":113,"name":"Water","parent":{"id":21,"name":"Transport and Logistics","parent":{"id":2,"name":"Service","parent":null}}}]';

    private SerializerInterface $serializer;

    public function __construct(SerializerInterface $serializer)
    {
        $this->serializer = $serializer;
    }

    public function load(ObjectManager $manager): void
    {
        /** @var SectorDto[] $data */
        $data = $this->serializer->deserialize(self::DATA, 'App\Dto\SectorDto[]', 'json');

        foreach ($data as $sectorDto) {
            $sector = new Sector();
            $sector->setName($sectorDto->getName());

            if(null !== $sectorDto->getParent()) {
                $parentDto = $sectorDto->getParent();

                /** @var Sector $parentSector */
                $parentSector = $this->getReference((string) $parentDto->getId());
                $sector->setParent($parentSector);
            }

            $manager->persist($sector);
            $manager->flush();

            $this->setReference((string) $sectorDto->getId(), $sector);
        }
    }
}
